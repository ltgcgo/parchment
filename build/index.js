"use strict";(()=>{var x=function(e,t="&",r="="){let i=new Map;return e.length&&e.slice(1).split(t).forEach(u=>{let a=decodeURIComponent(u),m=a.indexOf(r);m>=0?i.set(a.slice(0,m),a.slice(m+r.length)):i.set(a,null)}),i};var g=function(e,t=document){return t?.querySelector(e)},l=function(e,t=document){return Array.from(t?.querySelectorAll(e))};var b,D=new Worker("./worker.js"),w=x(location.search),o,y=!1,c=document,d=c.children[0],S=function(e){e.preventDefault(),e.stopPropagation(),console.debug(this.getAttribute("parchment"))},k=function(){location.hash=`#${this.id||""}`},s=function(e){return e?.length||(e?.length==0?e="index":e=w.get("p")||"index"),e.toLowerCase().indexOf(".md")<0?e+".md":e},A=function(){let e=history.state||{};e[s()]={sX:d.scrollLeft,sY:d.scrollTop},history.replaceState(e,"")},L=function(e){l("table",e).forEach(t=>{t.setAttribute("role","grid")}),l("img",e).forEach(t=>{t.setAttribute("decoding","async"),t.setAttribute("loading","lazy")}),l("h1, h2, h3, h4, h5, h6",e).forEach(t=>{t.addEventListener("click",k)}),l("a",e).forEach(t=>{let r=t.getAttribute("href"),i=r.indexOf(":"),u=r.indexOf("/");i>-1&&i<6&&u<8?t.setAttribute("target","_blank"):r[0]=="#"||(t.setAttribute("parchment",r),t.href=`?p=${r}`),t.addEventListener("click",S)})},$=new DOMParser,h=new Map,n,p,C=function(e){return h.has(e)?!0:(D.postMessage({id:e}),!1)};var E=async function(){for(;o.children.length>0;)n?n.body.appendChild(o.children[0]):o.removeChild(o.children[0]);f();let e=n.body.children.length,t=0;for(let r=0;r<e;r++)n.body.children[t].tagName=="H1"&&!t?t++:o.appendChild(n.body.children[t]);y=!0,location.hash&&(location.hash=location.hash),history.state&&history.state[s()]&&(d.scrollTop=history.state[s()].sY||0,d.scrollLeft=history.state[s()].sX||0)},P=async function(e){y=!1,e=s(e),C(e)?(n=h.get(e),E()):p=e};D.addEventListener("message",e=>{let t=e.data;if(t.ok){let r=$.parseFromString(t.data,"text/html");L(r),h.set(t.id,r),p==t.id&&(n=r,E())}else p==t.id});self.parsedDoms=h;var f=async function(){n?(self.currentDom=n,c.title=`${g("h1",n)?.innerText||"Untitled"} - ${b?.site?.name||"Parchment"}`):c.title=`Loading - ${b?.site?.name||"Parchment"}`};c.addEventListener("readystatechange",function(){switch(this.readyState){case"interactive":{o=g("main.container"),f(),P(w.get("path")||"");break}case"loaded":{f();break}}});fetch("./conf.json").then(e=>e.json()).then(e=>{b=e,f()});addEventListener("beforeunload",()=>{y&&A()});})();
